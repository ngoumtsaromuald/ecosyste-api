# Search System Staging Environment Configuration
# This file contains search-specific environment variables for staging

# =============================================================================
# ELASTICSEARCH CONFIGURATION
# =============================================================================
ELASTICSEARCH_HOST=elasticsearch
ELASTICSEARCH_PORT=9200
ELASTICSEARCH_INDEX_PREFIX=romapi_staging
ELASTICSEARCH_MAX_RETRIES=3
ELASTICSEARCH_REQUEST_TIMEOUT=30000
ELASTICSEARCH_PING_TIMEOUT=3000

# Index Configuration (Reduced for staging)
ELASTICSEARCH_SHARDS=1
ELASTICSEARCH_REPLICAS=0
ELASTICSEARCH_REFRESH_INTERVAL=5s
ELASTICSEARCH_MAX_RESULT_WINDOW=10000

# Search Performance
ELASTICSEARCH_SEARCH_TIMEOUT=10s
ELASTICSEARCH_BULK_SIZE=500
ELASTICSEARCH_BULK_TIMEOUT=30s
ELASTICSEARCH_SCROLL_SIZE=500
ELASTICSEARCH_SCROLL_TIMEOUT=5m

# =============================================================================
# REDIS SEARCH CACHE CONFIGURATION
# =============================================================================
REDIS_SEARCH_HOST=redis-search
REDIS_SEARCH_PORT=6379
REDIS_SEARCH_PASSWORD=${REDIS_SEARCH_PASSWORD}
REDIS_SEARCH_DB=1
REDIS_SEARCH_KEY_PREFIX=search:staging:

# Cache TTL Settings (shorter for staging)
SEARCH_CACHE_TTL=180
SEARCH_SUGGESTIONS_CACHE_TTL=1800
SEARCH_FACETS_CACHE_TTL=900
SEARCH_ANALYTICS_CACHE_TTL=600
SEARCH_POPULAR_TERMS_CACHE_TTL=3600

# =============================================================================
# SEARCH SERVICE CONFIGURATION
# =============================================================================
SEARCH_DEFAULT_SIZE=20
SEARCH_MAX_SIZE=100
SEARCH_DEFAULT_FROM=0
SEARCH_MAX_FROM=5000

# Search Features
SEARCH_FUZZY_ENABLED=true
SEARCH_FUZZY_DISTANCE=2
SEARCH_HIGHLIGHT_ENABLED=true
SEARCH_SUGGESTIONS_ENABLED=true
SEARCH_FACETS_ENABLED=true
SEARCH_ANALYTICS_ENABLED=true

# Search Scoring
SEARCH_BOOST_VERIFIED=1.5
SEARCH_BOOST_PREMIUM=1.3
SEARCH_BOOST_RECENT=1.2
SEARCH_BOOST_POPULAR=1.4

# =============================================================================
# SEARCH ANALYTICS CONFIGURATION
# =============================================================================
SEARCH_ANALYTICS_ENABLED=true
SEARCH_ANALYTICS_BATCH_SIZE=50
SEARCH_ANALYTICS_FLUSH_INTERVAL=15000
SEARCH_ANALYTICS_RETENTION_DAYS=30

# Privacy Settings
SEARCH_ANALYTICS_ANONYMIZE_IP=true
SEARCH_ANALYTICS_HASH_QUERIES=false
SEARCH_ANALYTICS_STORE_USER_AGENT=true

# =============================================================================
# SEARCH WORKER CONFIGURATION
# =============================================================================
SEARCH_WORKER_CONCURRENCY=3
SEARCH_WORKER_MAX_JOBS=50
SEARCH_WORKER_ATTEMPTS=3
SEARCH_WORKER_BACKOFF_TYPE=exponential
SEARCH_WORKER_BACKOFF_DELAY=2000

# Job Types
SEARCH_INDEXING_JOB_ENABLED=true
SEARCH_ANALYTICS_JOB_ENABLED=true
SEARCH_CLEANUP_JOB_ENABLED=true

# =============================================================================
# SEARCH INDEXER CONFIGURATION
# =============================================================================
SEARCH_INDEXER_SCHEDULE=0 */4 * * *
SEARCH_INDEXER_BATCH_SIZE=500
SEARCH_INDEXER_PARALLEL_BATCHES=2
SEARCH_INDEXER_TIMEOUT=180000

# Reindexing
SEARCH_REINDEX_ENABLED=true
SEARCH_REINDEX_SCHEDULE=0 3 * * 0
SEARCH_REINDEX_BATCH_SIZE=2000

# =============================================================================
# SEARCH RATE LIMITING
# =============================================================================
SEARCH_RATE_LIMIT_ENABLED=true
SEARCH_RATE_LIMIT_WINDOW=60000
SEARCH_RATE_LIMIT_MAX_REQUESTS=500
SEARCH_RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=false

# Per-endpoint limits (reduced for staging)
SEARCH_RATE_LIMIT_SEARCH=250
SEARCH_RATE_LIMIT_SUGGEST=100
SEARCH_RATE_LIMIT_FACETS=50

# =============================================================================
# SEARCH VALIDATION
# =============================================================================
SEARCH_VALIDATION_ENABLED=true
SEARCH_MAX_QUERY_LENGTH=200
SEARCH_MAX_FILTERS=20
SEARCH_ALLOWED_SORT_FIELDS=name,createdAt,updatedAt,popularity,rating
SEARCH_XSS_PROTECTION=true

# =============================================================================
# MULTILINGUAL SEARCH
# =============================================================================
SEARCH_MULTILINGUAL_ENABLED=true
SEARCH_DEFAULT_LANGUAGE=fr
SEARCH_SUPPORTED_LANGUAGES=fr,en
SEARCH_AUTO_DETECT_LANGUAGE=true
SEARCH_LANGUAGE_BOOST_FACTOR=1.2

# =============================================================================
# GEOGRAPHIC SEARCH
# =============================================================================
SEARCH_GEO_ENABLED=true
SEARCH_GEO_DEFAULT_RADIUS=50km
SEARCH_GEO_MAX_RADIUS=500km
SEARCH_GEO_PRECISION=7
SEARCH_GEO_DISTANCE_TYPE=arc

# =============================================================================
# SEARCH MONITORING
# =============================================================================
SEARCH_METRICS_ENABLED=true
SEARCH_HEALTH_CHECK_ENABLED=true
SEARCH_PERFORMANCE_MONITORING=true

# Alert Thresholds (more lenient for staging)
SEARCH_ALERT_ERROR_RATE_THRESHOLD=0.1
SEARCH_ALERT_LATENCY_THRESHOLD=2000
SEARCH_ALERT_ELASTICSEARCH_DOWN=true
SEARCH_ALERT_REDIS_DOWN=true

# =============================================================================
# SEARCH LOGGING
# =============================================================================
SEARCH_LOG_LEVEL=debug
SEARCH_LOG_QUERIES=true
SEARCH_LOG_SLOW_QUERIES=true
SEARCH_SLOW_QUERY_THRESHOLD=500
SEARCH_LOG_ERRORS=true
SEARCH_LOG_ANALYTICS=true

# =============================================================================
# SEARCH SECURITY
# =============================================================================
SEARCH_SECURITY_ENABLED=true
SEARCH_INPUT_SANITIZATION=true
SEARCH_QUERY_BLACKLIST_ENABLED=true
SEARCH_IP_WHITELIST_ENABLED=false

# =============================================================================
# SEARCH PERSONALIZATION
# =============================================================================
SEARCH_PERSONALIZATION_ENABLED=true
SEARCH_USER_HISTORY_ENABLED=true
SEARCH_USER_HISTORY_TTL=1296000
SEARCH_SAVED_SEARCHES_ENABLED=true
SEARCH_RECOMMENDATIONS_ENABLED=true

# =============================================================================
# SEARCH EXPORT
# =============================================================================
SEARCH_EXPORT_ENABLED=true
SEARCH_EXPORT_MAX_RESULTS=5000
SEARCH_EXPORT_FORMATS=json,csv
SEARCH_EXPORT_RATE_LIMIT=5

# =============================================================================
# DATA PATHS (for Docker volumes)
# =============================================================================
ELASTICSEARCH_DATA_PATH=./data/staging/elasticsearch
REDIS_SEARCH_DATA_PATH=./data/staging/redis-search
SEARCH_LOGS_PATH=./logs/staging/search
SEARCH_BACKUPS_PATH=./backups/staging/search